<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Свечной график за сутки</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <div id="candlestick-chart" style="width: 100%; height: 600px;"></div>
    
    <script>
        const generateData = () => {
            let data = [];
            let open = 10000;
            for (let i = 0; i < 1440; i++) {
                const high = open + Math.random() * 100;
                const low = open - Math.random() * 100;
                const close = Math.random() * (high - low) + low;

                data.push({
                    date: new Date(Date.now() - (1440 - i) * 60000).toISOString(),
                    open: open,
                    high: Math.max(high, close),
                    low: Math.min(low, close),
                    close: close,
                });

                open = close;
            }
            return data;
        };

        const candlestickData = generateData();

        var data = [{
            x: candlestickData.map(d => d.date),
            open: candlestickData.map(d => d.open),
            high: candlestickData.map(d => d.high),
            low: candlestickData.map(d => d.low),
            close: candlestickData.map(d => d.close),
            type: 'candlestick',
            name: 'BTC',
            increasing: { line: { color: 'green' } },
            decreasing: { line: { color: 'red' } }
        }];

        var layout = {
            title: 'Свечной график цен на Bitcoin за сутки',
            xaxis: { 
                title: 'Дата', 
                type: 'date',
                range: [candlestickData[0].date, candlestickData[candlestickData.length - 1].date]
            },
            yaxis: {
                title: 'Цена (USD)',
                range: [Math.min(...candlestickData.map(d => d.low)), Math.max(...candlestickData.map(d => d.high))]
            }
        };

        const graphDiv = document.getElementById('candlestick-chart');
        Plotly.newPlot(graphDiv, data, layout);

        graphDiv.onwheel = function(event) {
            event.preventDefault(); // предотвращаем прокрутку страницы

            const delta = -event.deltaY; // получаем направление прокрутки
            const zoomFactor = 0.1; // коэффициент зума
            const xRange = graphDiv.layout.xaxis.range;
            const yRange = graphDiv.layout.yaxis.range;
            const newXRange = [
                xRange[0] + (xRange[1] - xRange[0]) * (delta > 0 ? -zoomFactor : zoomFactor),
                xRange[1] - (xRange[1] - xRange[0]) * (delta > 0 ? -zoomFactor : zoomFactor)
            ];
            const newYRange = [
                yRange[0] + (yRange[1] - yRange[0]) * (delta > 0 ? -zoomFactor : zoomFactor),
                yRange[1] - (yRange[1] - yRange[0]) * (delta > 0 ? -zoomFactor : zoomFactor)
            ];

            if (newXRange[0] < newXRange[1] && newYRange[0] < newYRange[1]) {
                Plotly.relayout(graphDiv, {
                    'xaxis.range': newXRange,
                    'yaxis.range': newYRange
                });
            }
        };
    </script>
</body>
</html>
